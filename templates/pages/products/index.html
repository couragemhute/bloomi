{% extends 'layouts/base.html' %}
{% load static %}

{% block navigation %}
<!-- breadcumb-area start -->
<div class="breadcumb-area black-opacity bg-img-3">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <div class="breadcumb-wrap">
                    <h2>Our Products</h2>
                </div>
            </div>
        </div>
    </div>
    <div class="breadcumb-menu">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul>
                        <li><a href="{% url 'home' %}">Home</a></li>
                        <li>/</li>
                        <li>Products</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- breadcumb-area end -->
{% endblock %}

{% block content %}

<!-- products-area start -->
<div class="pricing-table-area ptb-100 bg-1">
    <div class="container">
        <div class="row">
            <div class="col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12">
                <div class="section-title text-center">
                    <h2>Products by Mistnex Dynamics</h2>
                    <p>We create intelligent digital solutions to help businesses grow. Currently available: our flagship WhatsApp Chatbot solution. More innovative products are coming soon.</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="pricing-table">
                <div class="pricing-grids active-price text-center">

                    <!-- WhatsApp Chatbot Product -->
                    <div class="col-md-4 col-sm-6 col-xs-12">
                        <div class="pricing-wrap">
                            <h3>WhatsApp Chatbot</h3>
                            <h4>Custom Quote</h4>
                            <ul>
                                <li>24/7 Customer Engagement</li>
                                <li>Automated Responses & Workflows</li>
                                <li>Order Processing & Support</li>
                                <li>WhatsApp Catalog Integration</li>
                            </ul>
                        </div>
                        <div class="mt-3">
                            <button id="wa-onboard-btn" class="btn btn-primary">Get Started</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>
<!-- products-area end -->

<!-- quote-area start -->
<div class="quote-area bg-1">
    <div class="container">
        <div class="row">
            <div class="col-sm-9 col-xs-12">
                <div class="quote-wrap">
                    <h2>Let Mistnex Dynamics help you automate, engage, and grow ‚Äî starting with WhatsApp.</h2>
                </div>
            </div>
            <div class="col-sm-3 col-xs-12">
                <div class="quote-wrap text-right">
                    <button id="wa-onboard-btn-2" class="btn btn-primary">Request Onboarding</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- quote-area end -->

<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
<script>
window.fbAsyncInit = function() {
    FB.init({
        appId: "{{ FB_APP_ID }}",
        autoLogAppEvents: true,
        xfbml: true,
        version: "{{ FB_GRAPH_API_VERSION }}"
    });
};

// Callback when FB.login returns
function fbLoginCallback(response) {
    console.log("üîë FB.login callback:", response);
    if (response.authResponse && response.authResponse.code) {
        const code = response.authResponse.code;
        console.log("‚úÖ Got auth code:", code);

        // Send code to Django backend
        fetch("{% url 'exchange_fb_code' %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({
                code: code
            })
        })
        .then(res => res.json())
        .then(data => console.log("üì© Server response:", data))
        .catch(err => console.error("‚ùå Backend error:", err));
    } else {
        console.warn("‚ö†Ô∏è No authResponse in FB.login response", response);
    }
}

// Launch embedded signup
function launchWhatsAppSignup() {
    FB.login(fbLoginCallback, {
        config_id: "{{ FB_CONFIG_ID }}",
        response_type: 'code',
        override_default_response_type: true,
        extras: {
            version: 'v3',
            setup: {},
            features: [
                { name: "{{ FB_FEATURE_NAME }}" }
            ],
            featureType: "{{ FB_FEATURE_TYPE }}",
            sessionInfoVersion: '3',
        }
    });
}

// Attach click handlers
document.getElementById('wa-onboard-btn').addEventListener('click', launchWhatsAppSignup);
document.getElementById('wa-onboard-btn-2').addEventListener('click', launchWhatsAppSignup);
</script>


{% endblock %}
